<!-- REPLACE WHOLE FILE: /index.html -->
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>

  <title>Bongstudio • Cửa hàng affiliate đa sàn</title>
  <meta name="description" content="Bongstudio – cửa hàng affiliate đa sàn, chọn lọc sản phẩm từ Shopee, Lazada, TikTok. Tập trung các deal ngon, dễ mua, dễ so sánh cho cộng đồng."/>
  <link rel="canonical" href="https://bongstudio68.github.io/"/>
  <meta name="robots" content="index,follow"/>

  <!-- OPEN GRAPH -->
  <meta property="og:title" content="Bongstudio • Cửa hàng affiliate đa sàn"/>
  <meta property="og:description" content="Bongstudio – cửa hàng affiliate đa sàn, chọn lọc sản phẩm từ Shopee, Lazada, TikTok."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://bongstudio68.github.io/"/>
  <meta property="og:image" content="https://bongstudio68.github.io/assets/img/categories/thoi-trang.webp"/>

  <!-- VERIFY: Google Search Console (chèn mã nếu có) -->
  <meta name="google-site-verification" content=""/>

  <!-- GA4: Bongstudio -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-550F47VKPR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-550F47VKPR');
  </script>

  <!-- CSS chính (giữ nguyên file hiện tại của Bongstudio) -->
  <link rel="stylesheet" href="/assets/css/styles.css"/>

  <!-- Style đen – hồng cho Bongstudio -->
  <style>
    :root {
      --bg: #050816;
      --bg-soft: #0b1020;
      --card: #020617;
      --border-soft: rgba(148,163,184,.35);
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --accent: #ec4899;
      --accent-soft: #f472b6;
      --error: #f97373;
      --warn: #facc15;
      --ok: #4ade80;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top, #111827 0, #020617 55%, #000 100%);
      color: var(--text-main);
    }

    a {
      color: inherit;
    }

    .home-hero {
      padding: 2.5rem 0 1.5rem;
      background: linear-gradient(135deg, #020617 0%, #0b1120 45%, #111827 100%);
    }
    .home-hero h1 {
      font-size: 1.6rem;
      margin-bottom: .5rem;
      color: #fff;
    }
    .home-hero p {
      max-width: 640px;
      font-size: .95rem;
      color: var(--text-muted);
    }
    .home-hero-actions {
      margin-top: 1.25rem;
      display: flex;
      flex-wrap: wrap;
      gap: .75rem;
    }

    .btn-primary,
    .btn-ghost {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: .65rem 1.2rem;
      border-radius: 999px;
      font-size: .9rem;
      text-decoration: none;
      border: 1px solid var(--accent-soft);
      cursor: pointer;
      transition:
        transform .1s ease,
        box-shadow .1s ease,
        background-color .1s ease,
        color .1s ease,
        border-color .1s ease;
      white-space: nowrap;
    }
    .btn-primary {
      background: linear-gradient(135deg, #ec4899, #db2777);
      color: #fff;
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(0,0,0,.35);
    }
    .btn-ghost {
      background: transparent;
      color: var(--accent-soft);
    }
    .btn-ghost:hover {
      background: rgba(236,72,153,.08);
      border-color: var(--accent);
    }

    .home-categories {
      padding: 1.5rem 0 1rem;
      background: transparent;
    }
    .home-categories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: .75rem;
    }
    .category-card {
      display: block;
      padding: .8rem .9rem;
      border-radius: .9rem;
      border: 1px solid var(--border-soft);
      background: rgba(15,23,42,.9);
      text-decoration: none;
      font-size: .9rem;
      line-height: 1.35;
      color: var(--text-main);
    }
    .category-card strong {
      display: block;
      margin-bottom: .15rem;
      font-size: .92rem;
      color: #e5e7eb;
    }
    .category-card span {
      display: block;
      color: var(--text-muted);
    }

    .home-products {
      padding: 1.5rem 0 2.25rem;
    }
    .home-section-head {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: .75rem;
      margin-bottom: .75rem;
    }
    .home-section-head h2 {
      font-size: 1.2rem;
      color: #f9fafb;
      margin: 0 0 .15rem;
    }
    .home-section-head p {
      font-size: .85rem;
      color: var(--text-muted);
      margin: 0;
    }

    .home-status {
      font-size: .8rem;
      color: var(--text-muted);
      text-align: right;
      min-height: 1.2em;
    }
    .home-status[data-tone="error"] {
      color: var(--error);
    }
    .home-status[data-tone="warn"] {
      color: var(--warn);
    }
    .home-status[data-tone="ok"] {
      color: var(--ok);
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: .9rem;
    }
    .product-card {
      border-radius: 1rem;
      border: 1px solid var(--border-soft);
      background: rgba(15,23,42,.96);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .product-card .product-thumb {
      display: block;
      position: relative;
      padding-top: 100%;
      overflow: hidden;
      background: #020617;
    }
    .product-card .product-thumb img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .product-card-body {
      padding: .7rem .75rem .75rem;
      display: flex;
      flex-direction: column;
      gap: .35rem;
      flex: 1;
    }
    .product-name {
      font-size: .95rem;
      line-height: 1.4;
      max-height: 2.8em; /* ~2 dòng */
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      color: #e5e7eb;
    }
    .product-merchant {
      font-size: .8rem;
      color: var(--text-muted);
    }
    .product-price {
      display: flex;
      align-items: baseline;
      gap: .4rem;
      margin-top: .1rem;
    }
    .product-price-current {
      font-weight: 600;
      font-size: .98rem;
      color: var(--accent-soft);
    }
    .product-price-old {
      font-size: .8rem;
      text-decoration: line-through;
      color: var(--text-muted);
    }
    .product-actions {
      margin-top: .45rem;
      display: flex;
      gap: .4rem;
    }
    .btn-buy {
      flex: 1;
      font-size: .85rem;
    }
    .btn-secondary {
      padding: .55rem .8rem;
      border-radius: .75rem;
      border: 1px solid var(--border-soft);
      font-size: .82rem;
      background: rgba(15,23,42,.7);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
    }
    .btn-secondary:hover {
      border-color: var(--accent-soft);
      color: #e5e7eb;
    }

    .site-header {
      border-bottom: 1px solid rgba(148,163,184,.3);
      background: rgba(15,23,42,.95);
      backdrop-filter: blur(10px);
    }
    .site-header .container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: .6rem 0;
      gap: .75rem;
    }
    .logo {
      text-decoration: none;
      color: inherit;
      display: inline-flex;
      flex-direction: column;
      line-height: 1.1;
    }
    .logo-main {
      font-weight: 700;
      font-size: 1.25rem;
      color: var(--accent-soft);
    }
    .logo-sub {
      font-size: .8rem;
      color: var(--text-muted);
    }
    .main-nav ul {
      list-style: none;
      display: flex;
      gap: .75rem;
      padding: 0;
      margin: 0;
      font-size: .85rem;
    }
    .main-nav a {
      text-decoration: none;
      padding: .35rem .6rem;
      border-radius: 999px;
      color: var(--text-muted);
    }
    .main-nav a:hover {
      color: #e5e7eb;
    }
    .main-nav a[data-nav="home"].is-active {
      background: var(--accent);
      color: #fff;
    }

    .site-footer {
      border-top: 1px solid rgba(148,163,184,.2);
      padding: 1rem 0 1.5rem;
      font-size: .85rem;
      background: #020617;
      color: var(--text-muted);
    }
    .site-footer strong {
      color: #e5e7eb;
    }
    .site-footer a {
      color: var(--accent-soft);
    }

    .container {
      max-width: 1120px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    @media (max-width: 640px) {
      .site-header .container {
        flex-direction: column;
        align-items: flex-start;
      }
      .main-nav ul {
        flex-wrap: wrap;
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <a href="/" class="logo">
        <span class="logo-main">Bongstudio</span>
        <span class="logo-sub">Cửa hàng affiliate đa sàn</span>
      </a>
      <nav class="main-nav">
        <ul>
          <li><a href="/" data-nav="home" class="is-active">Trang chủ</a></li>
          <li><a href="/store.html" data-nav="store">Cửa hàng</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <!-- HERO: giới thiệu nhanh -->
    <section class="home-hero">
      <div class="container">
        <h1>Chọn sản phẩm, Bongstudio lọc deal giúp bạn</h1>
        <p>
          Tổng hợp sản phẩm từ Shopee, Lazada, TikTok… được lọc lại cho dễ xem,
          dễ mua. Link mua là link affiliate – bạn không mất thêm chi phí, nhưng
          giúp Bongstudio có thêm thu nhập để duy trì nội dung.
        </p>
        <div class="home-hero-actions">
          <a href="/store.html" class="btn-primary">Vào cửa hàng Bongstudio</a>
          <a href="https://www.facebook.com/profile.php?id=100050291345045" target="_blank" rel="noopener" class="btn-ghost">
            Nhắn tin Facebook để hỏi thêm
          </a>
        </div>
      </div>
    </section>

    <!-- DANH MỤC NỔI BẬT -->
    <section class="home-categories">
      <div class="container">
        <div class="home-section-head">
          <div>
            <h2>Danh mục đang có</h2>
            <p>Nhấp vào để xem đầy đủ trong cửa hàng.</p>
          </div>
        </div>
        <div class="home-categories-grid">
          <a class="category-card" href="/store.html">
            <strong>Gia dụng, decor nhà cửa</strong>
            <span>Đồ dùng, trang trí cho căn nhà gọn gàng, dễ sống hơn.</span>
          </a>
          <a class="category-card" href="/store.html">
            <strong>Thời trang nữ</strong>
            <span>Đồ mặc hàng ngày, đi làm, đi chơi – ưu tiên dễ phối, dễ mặc.</span>
          </a>
          <a class="category-card" href="/store.html">
            <strong>Thời trang nam</strong>
            <span>Áo quần basic, dễ phối, không quá “làm màu”.</span>
          </a>
          <a class="category-card" href="/store.html">
            <strong>Quần áo em bé</strong>
            <span>Đồ cho bé thoáng, dễ giặt, ưu tiên chất liệu ổn.</span>
          </a>
          <a class="category-card" href="/store.html">
            <strong>Sức khỏe &amp; TPCN</strong>
            <span>Một số sản phẩm chăm sóc sức khỏe được chọn lọc.</span>
          </a>
          <a class="category-card" href="/store.html">
            <strong>Sách</strong>
            <span>Sách hay, dễ đọc, có thể ứng dụng được.</span>
          </a>
          <a class="category-card" href="/store.html">
            <strong>Đồ ăn &amp; đồ uống</strong>
            <span>Một vài món tiện lợi, dễ mua online.</span>
          </a>
        </div>
      </div>
    </section>

    <!-- SẢN PHẨM NỔI BẬT: ĐỌC TỪ affiliates.json, TỐI ĐA 100 SP -->
    <section class="home-products">
      <div class="container">
        <div class="home-section-head">
          <div>
            <h2>Sản phẩm nổi bật</h2>
            <p>Các sản phẩm được đánh dấu <code>featured: true</code> trong Bongstudio.</p>
          </div>
          <div id="homeFeaturedStatus" class="home-status"></div>
        </div>

        <div id="homeFeaturedGrid" class="product-grid">
          <!-- JS sẽ render tối đa 100 product-card vào đây -->
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <div>
        <strong>Bongstudio</strong> – cửa hàng affiliate chọn lọc sản phẩm từ nhiều sàn.
      </div>
      <div>
        Liên hệ: 0978 557 797 ·
        Facebook:
        <a href="https://www.facebook.com/profile.php?id=100050291345045" target="_blank" rel="noopener">
          Mai (Bongstudio)
        </a>
      </div>
      <div style="margin-top:.3rem; opacity:.8;">
        Khi bạn mua qua link affiliate, Bongstudio có thể nhận hoa hồng nhỏ từ sàn nhưng giá bạn trả không đổi.
      </div>
    </div>
  </footer>

  <!-- SCRIPT: ĐỌC affiliates.json, LỌC featured, TỐI ĐA 100 SP, SINH ISCLIX + GA4 -->
  <script>
    ;(function () {
      const GRID   = document.getElementById("homeFeaturedGrid");
      const STATUS = document.getElementById("homeFeaturedStatus");
      const AFF_PATH = "/assets/data/affiliates.json";
      const FALLBACK_IMG = "/assets/img/products/placeholder.webp";

      if (!GRID) return;

      function setStatus(msg, tone) {
        if (!STATUS) return;
        STATUS.textContent = msg || "";
        if (tone) STATUS.dataset.tone = tone;
        else STATUS.removeAttribute("data-tone");
      }

      function escapeHtml(str) {
        return String(str || "")
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }

      function formatPrice(v) {
        const n = Number(v || 0);
        if (!n) return "";
        try {
          return n.toLocaleString("vi-VN") + "₫";
        } catch (_) {
          return n + "₫";
        }
      }

      function normalizeMerchant(raw) {
        const v = String(raw || "").toLowerCase();
        if (!v) return "";
        if (v.includes("shopee")) return "shopee";
        if (v.includes("lazada")) return "lazada";
        if (v.includes("tiki"))   return "tiki";
        if (v.includes("tik"))    return "tiktok"; // tik tok, tiktokshop, v.v.
        return v;
      }

      function merchantLabel(m) {
        switch (m) {
          case "shopee": return "Shopee";
          case "lazada": return "Lazada";
          case "tiktok": return "TikTok Shop";
          case "tiki":   return "Tiki";
          default:       return "sàn";
        }
      }

      function buildCard(product) {
        const sku   = product.sku || "";
        const name  = product.name || product.title || "";
        const img   = product.image || product.image_url || FALLBACK_IMG;
        const merchantRaw = product.merchant || product.platform || "";
        const merchant    = normalizeMerchant(merchantRaw);
        const origin      = product.origin_url || product.origin || "";
        const priceNow    = product.price_vnd || product.price || product.final_price_vnd || 0;
        const priceOld    = product.price_old_vnd || product.list_price_vnd || 0;

        const priceNowText = formatPrice(priceNow);
        const priceOldText = formatPrice(priceOld);

        return '' +
          '<article class="product-card"' +
            ' data-sku="' + escapeHtml(sku) + '"' +
            ' data-merchant="' + escapeHtml(merchant) + '"' +
            ' data-origin-url="' + escapeHtml(origin) + '"' +
          '>' +
            '<a class="product-thumb" href="/store.html" aria-label="Xem thêm trong cửa hàng">' +
              '<img src="' + escapeHtml(img) + '" loading="lazy" alt="' + escapeHtml(name) + '"/>' +
            '</a>' +
            '<div class="product-card-body">' +
              '<h3 class="product-name">' + escapeHtml(name) + '</h3>' +
              '<div class="product-merchant">Nguồn: ' + escapeHtml(merchantLabel(merchant)) + '</div>' +
              '<div class="product-price">' +
                (priceNowText
                  ? '<span class="product-price-current">' + escapeHtml(priceNowText) + '</span>'
                  : ''
                ) +
                (priceOldText && priceOld > priceNow
                  ? '<span class="product-price-old">' + escapeHtml(priceOldText) + '</span>'
                  : ''
                ) +
              '</div>' +
              '<div class="product-actions">' +
                '<button class="btn-primary btn-buy js-mxd-buy" type="button">' +
                  'Mua trên ' + escapeHtml(merchantLabel(merchant)) +
                '</button>' +
                '<a class="btn-secondary" href="/store.html">Xem thêm</a>' +
              '</div>' +
            '</div>' +
          '</article>';
      }

      // Gốc deeplink của AccessTrade cho Bongstudio
      const AFF_BASE = {
        shopee: "https://go.isclix.com/deep_link/6837508078414670452/4751584435713464237",
        lazada: "https://go.isclix.com/deep_link/6837508078414670452/5127144557053758578",
        tiktok: "https://go.isclix.com/deep_link/6837508078414670452/6648523843406889655"
      };

      const UTM_BASE =
        "utm_source=" + encodeURIComponent(location.hostname) +
        "&utm_medium=affiliate";

      function makeIsclixUrl(base, originUrl, sku, merchant) {
        if (!base || !originUrl) return originUrl;
        const head = base + (base.includes("?") ? "&" : "?") +
          "url=" + encodeURIComponent(originUrl);
        const params = [
          UTM_BASE,
          "utm_campaign=" + encodeURIComponent(merchant || ""),
          "sub1=" + encodeURIComponent(sku || ""),
          "sub2=" + encodeURIComponent(merchant || "")
        ];
        return head + "&" + params.join("&");
      }

      function wireBuyButtons() {
        const cards = GRID.querySelectorAll(".product-card[data-origin-url][data-merchant]");
        if (!cards.length) return;

        cards.forEach(function (card) {
          const sku       = card.getAttribute("data-sku") || "";
          const merchant0 = card.getAttribute("data-merchant") || "";
          const merchant  = normalizeMerchant(merchant0);
          const origin    = card.getAttribute("data-origin-url") || "";
          const base      = AFF_BASE[merchant];
          const btn       = card.querySelector(".js-mxd-buy");
          if (!btn || !origin) return;

          const productNameEl = card.querySelector(".product-name");
          const productName   = productNameEl ? productNameEl.textContent.trim() : "";

          const finalUrl = makeIsclixUrl(base, origin, sku, merchant);

          btn.addEventListener("click", function (ev) {
            ev.preventDefault();
            const urlToOpen = finalUrl || origin;
            if (!urlToOpen) return;

            // GA4 event (nếu gtag có sẵn)
            try {
              if (typeof window.gtag === "function") {
                window.gtag("event", "click_buy", {
                  event_category: "affiliate",
                  event_label: merchant || "",
                  value: 1,
                  items: sku ? [{
                    item_id: sku,
                    item_name: productName
                  }] : undefined
                });
              }
            } catch (e) {
              console.warn("[Bongstudio][GA4] Lỗi gửi event click_buy:", e);
            }

            window.open(urlToOpen, "_blank", "noopener");
          });
        });
      }

      function isActiveProduct(p) {
        if (!p) return false;
        if (p.status === false || p.status === "false" || p.status === 0) return false;
        return true;
      }

      async function loadFeatured() {
        try {
          setStatus("Đang tải sản phẩm nổi bật…", "");
          const res = await fetch(AFF_PATH + "?v=" + Date.now(), { cache: "no-store" });
          if (!res.ok) {
            throw new Error("Không đọc được affiliates.json: HTTP " + res.status);
          }

          const raw = await res.json();
          const all = Array.isArray(raw) ? raw : (raw.items || []);
          if (!Array.isArray(all)) {
            console.warn("[Bongstudio][home-featured] Định dạng affiliates.json lạ:", raw);
          }

          let featured = (all || []).filter(function (p) {
            if (!isActiveProduct(p)) return false;
            return p.featured === true || p.featured === "true" || p.featured === 1;
          });

          // Giới hạn 100 sản phẩm
          featured = featured.slice(0, 100);

          if (!featured.length) {
            GRID.innerHTML = "";
            setStatus("Chưa có sản phẩm nào được đánh dấu nổi bật (featured: true).", "warn");
            return;
          }

          GRID.innerHTML = featured.map(buildCard).join("");
          wireBuyButtons();

          setStatus("Đang hiển thị " + featured.length + " sản phẩm nổi bật.", "ok");
        } catch (err) {
          console.error("[Bongstudio][home-featured] Lỗi:", err);
          GRID.innerHTML = "";
          setStatus("Lỗi khi tải danh sách sản phẩm. Vui lòng thử lại sau.", "error");
        }
      }

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", loadFeatured);
      } else {
        loadFeatured();
      }
    })();
  </script>
</body>
</html>
