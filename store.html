<!-- REPLACE WHOLE FILE: /store.html -->
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>

  <title>Cửa hàng • Bongstudio</title>
  <meta name="description" content="Cửa hàng Bongstudio – danh mục sản phẩm chọn lọc: Gia dụng, Thời trang, Mẹ & Bé, Sức khỏe, Sách, Đồ ăn… từ Shopee, Lazada, TikTok."/>
  <link rel="canonical" href="https://bongstudio68.github.io/store.html"/>
  <meta name="robots" content="index,follow"/>

  <!-- OPEN GRAPH -->
  <meta property="og:title" content="Cửa hàng • Bongstudio"/>
  <meta property="og:description" content="Danh mục sản phẩm chọn lọc cho cộng đồng Bongstudio – tổng hợp từ nhiều sàn thương mại điện tử."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://bongstudio68.github.io/store.html"/>

  <!-- TODO: nếu có GA4 riêng cho Bongstudio, copy lại script GA4 giống index.html đặt ngay trên body -->

  <style>
    :root{
      --bg:#020617;
      --bg-soft:#020617;
      --fg:#e5e7eb;
      --muted:#9ca3af;
      --card:#0b1220;
      --card-soft:#020617;
      --border:#1f2937;
      --accent:#ec4899;
      --accent-soft:#f472b6;
      --accent-text:#ffffff;
      --chip:#f97316;
      --danger:#f97373;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      background:radial-gradient(circle at top,#111827 0,var(--bg) 40%,#000 100%);
      color:var(--fg);
    }
    a{color:inherit;text-decoration:none}
    a:hover{text-decoration:none}

    .shell{
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    .site-header{
      position:sticky;
      top:0;
      z-index:20;
      backdrop-filter:blur(14px);
      background:linear-gradient(to bottom,rgba(15,23,42,.95),rgba(15,23,42,.88),transparent);
      border-bottom:1px solid rgba(15,23,42,.9);
    }
    .container{
      max-width:1160px;
      margin:0 auto;
      padding:12px 16px;
    }
    .header-inner{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:8px;
      font-weight:700;
      letter-spacing:.03em;
    }
    .brand-mark{
      width:26px;
      height:26px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 20%,#f9a8d4,#ec4899 40%,#4c1d95 100%);
      box-shadow:0 0 0 1px rgba(248,250,252,.1),0 0 18px rgba(236,72,153,.7);
    }
    .brand-text-main{
      font-size:16px;
    }
    .brand-text-sub{
      display:block;
      font-weight:400;
      font-size:11px;
      color:var(--muted);
    }

    .nav{
      display:flex;
      gap:12px;
      align-items:center;
      font-size:14px;
    }
    .nav a{
      padding:4px 10px;
      border-radius:999px;
      color:var(--muted);
      border:1px solid transparent;
      transition:.16s ease;
    }
    .nav a:hover{
      color:var(--fg);
      border-color:rgba(148,163,184,.6);
      background:rgba(15,23,42,.7);
    }
    .nav a.is-active{
      color:var(--accent-text);
      border-color:var(--accent-soft);
      background:linear-gradient(90deg,var(--accent),var(--accent-soft));
      box-shadow:0 0 20px rgba(236,72,153,.6);
    }

    main{
      flex:1;
    }

    .store-hero{
      padding:12px 16px 4px;
    }
    .store-hero-inner{
      max-width:1160px;
      margin:0 auto;
    }
    .store-title{
      font-size:24px;
      font-weight:700;
      margin:4px 0 6px;
    }
    .store-subtitle{
      max-width:720px;
      font-size:14px;
      color:var(--muted);
      line-height:1.5;
    }
    .store-tagline{
      margin-top:8px;
      font-size:12px;
      color:var(--muted);
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      align-items:center;
    }
    .chip-outline{
      border-radius:999px;
      border:1px dashed rgba(148,163,184,.7);
      padding:2px 8px;
      font-size:11px;
    }

    .toolbar-wrap{
      padding:0 16px 4px;
    }
    .toolbar{
      max-width:1160px;
      margin:0 auto;
      margin-top:8px;
      padding:10px 12px;
      border-radius:12px;
      background:rgba(15,23,42,.85);
      border:1px solid rgba(31,41,55,.9);
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:flex-end;
    }
    .toolbar-group{
      display:flex;
      flex-direction:column;
      gap:4px;
      min-width:160px;
      flex:1 1 180px;
    }
    .toolbar-label{
      font-size:12px;
      color:var(--muted);
    }
    select{
      width:100%;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(55,65,81,.95);
      background:radial-gradient(circle at top,rgba(31,41,55,.9),rgba(15,23,42,1));
      color:var(--fg);
      font-size:13px;
      outline:none;
    }
    select:focus{
      border-color:var(--accent-soft);
      box-shadow:0 0 0 1px rgba(236,72,153,.5);
    }

    .toolbar-meta{
      font-size:12px;
      color:var(--muted);
      margin-left:auto;
      text-align:right;
      min-width:160px;
    }

    .store-meta-bar{
      padding:4px 16px 0;
      font-size:11px;
      color:var(--muted);
    }
    .store-meta-inner{
      max-width:1160px;
      margin:0 auto;
      display:flex;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    .store-meta-inner code{
      font-size:11px;
      padding:1px 6px;
      border-radius:6px;
      background:rgba(15,23,42,.95);
      border:1px solid rgba(31,41,55,1);
      color:#e5e7eb;
    }

    .products-wrap{
      padding:8px 16px 32px;
    }
    .products-inner{
      max-width:1160px;
      margin:0 auto;
    }
    .products-heading{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin-bottom:10px;
    }
    .products-heading h2{
      font-size:16px;
      margin:0;
    }
    .products-heading small{
      font-size:11px;
      color:var(--muted);
    }

    .product-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(190px,1fr));
      gap:12px;
    }
    .product-card{
      background:radial-gradient(circle at top,rgba(15,23,42,.9),rgba(2,6,23,1));
      border-radius:16px;
      border:1px solid rgba(31,41,55,1);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:100%;
      box-shadow:0 14px 40px rgba(15,23,42,.8);
      position:relative;
    }
    .product-card.dev-highlight{
      border-color:var(--accent-soft);
      box-shadow:0 0 0 1px rgba(236,72,153,.7),0 18px 50px rgba(236,72,153,.55);
    }
    .badge-featured{
      position:absolute;
      top:8px;
      left:8px;
      padding:2px 8px;
      border-radius:999px;
      font-size:10px;
      font-weight:600;
      text-transform:uppercase;
      background:rgba(236,72,153,.9);
      color:#fff;
      box-shadow:0 0 10px rgba(236,72,153,.7);
    }
    .badge-sku{
      position:absolute;
      top:8px;
      right:8px;
      padding:2px 8px;
      border-radius:999px;
      font-size:10px;
      background:rgba(15,23,42,.85);
      color:var(--muted);
      border:1px solid rgba(31,41,55,1);
    }

    .product-media{
      position:relative;
      padding-top:100%;
      background:radial-gradient(circle at 20% 0,#0f172a,#020617);
      overflow:hidden;
    }
    .product-media img{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
      transition:transform .22s ease;
    }
    .product-card:hover .product-media img{
      transform:scale(1.05);
    }

    .product-body{
      padding:10px 10px 12px;
      display:flex;
      flex-direction:column;
      gap:4px;
      flex:1;
    }
    .product-title{
      font-size:13px;
      font-weight:600;
      margin:0;
      min-height:2.6em;
    }
    .product-merchant,
    .product-brand{
      font-size:11px;
      color:var(--muted);
    }
    .product-price{
      font-size:14px;
      font-weight:700;
      margin-top:4px;
    }
    .product-price span{
      font-size:11px;
      font-weight:400;
      color:var(--muted);
      margin-left:6px;
      text-decoration:line-through;
    }

    .product-footer{
      margin-top:8px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .btn-buy{
      display:inline-flex;
      justify-content:center;
      align-items:center;
      padding:8px 10px;
      border-radius:999px;
      font-size:13px;
      font-weight:600;
      border:none;
      cursor:pointer;
      background:linear-gradient(90deg,var(--accent),var(--accent-soft));
      color:var(--accent-text);
      box-shadow:0 12px 30px rgba(236,72,153,.6);
      text-align:center;
    }
    .btn-buy:hover{
      filter:brightness(1.03);
      transform:translateY(-1px);
    }
    .meta-line{
      font-size:11px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      gap:4px;
      flex-wrap:wrap;
    }

    .empty{
      font-size:13px;
      color:var(--muted);
      padding:14px 0;
    }

    .error{
      font-size:13px;
      color:var(--danger);
      padding:14px 0;
    }

    .footer-meta{
      padding:8px 16px 20px;
      font-size:11px;
      color:var(--muted);
    }
    .footer-meta-inner{
      max-width:1160px;
      margin:0 auto;
      border-top:1px dashed rgba(55,65,81,.9);
      padding-top:8px;
      display:flex;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
    }

    @media (max-width:640px){
      .header-inner{flex-direction:column;align-items:flex-start}
      .toolbar{flex-direction:column;align-items:stretch}
      .toolbar-meta{text-align:left;margin-left:0}
      .products-heading{flex-direction:column;align-items:flex-start}
    }
  </style>
</head>
<body>
<div class="shell">
  <header class="site-header">
    <div class="container">
      <div class="header-inner">
        <a href="/" class="brand">
          <span class="brand-mark" aria-hidden="true"></span>
          <span>
            <span class="brand-text-main">Bongstudio</span>
            <span class="brand-text-sub">Cửa hàng affiliate đa sàn</span>
          </span>
        </a>
        <nav class="nav">
          <a href="/">Trang chủ</a>
          <a href="/store.html" class="is-active">Cửa hàng</a>
        </nav>
      </div>
    </div>
  </header>

  <main>
    <section class="store-hero">
      <div class="store-hero-inner">
        <div class="store-title">Cửa hàng Bongstudio</div>
        <p class="store-subtitle">
          Đây là kho sản phẩm chọn lọc cho cộng đồng Bongstudio – mỗi món đều có link mua rõ ràng, ưu
          tiên dễ dùng, giá hợp lý, uy tín. Mỗi bộ link là link affiliate: giá bạn không đổi, Bongstudio
          được thêm chút hoa hồng để duy trì nội dung.
        </p>
        <div class="store-tagline">
          <span class="chip-outline">Shopee • Lazada • TikTok &amp; hơn thế nữa</span>
          <span class="chip-outline">Lọc theo danh mục hoặc sắp xếp theo giá</span>
        </div>
      </div>
    </section>

    <section class="toolbar-wrap">
      <div class="toolbar">
        <div class="toolbar-group">
          <span class="toolbar-label">Danh mục</span>
          <select id="filterCategory">
            <!-- JS sẽ fill option; default = all -->
          </select>
        </div>
        <div class="toolbar-group">
          <span class="toolbar-label">Sắp xếp</span>
          <select id="filterSort">
            <option value="default">Tất cả</option>
            <option value="price-asc">Giá tăng dần</option>
            <option value="price-desc">Giá giảm dần</option>
            <option value="updated-desc">Mới cập nhật</option>
          </select>
        </div>
        <div class="toolbar-meta" id="toolbarMeta">
          Đang tải dữ liệu…
        </div>
      </div>
    </section>

    <section class="store-meta-bar">
      <div class="store-meta-inner">
        <div>Dữ liệu đang lấy từ kho JSON <code>/assets/data/affiliates.json</code>.</div>
        <div id="devHint"></div>
      </div>
    </section>

    <section class="products-wrap">
      <div class="products-inner">
        <div class="products-heading">
          <h2>Tất cả sản phẩm</h2>
          <small id="headingMeta">–</small>
        </div>
        <div id="productGrid" class="product-grid"></div>
        <div id="productMessage"></div>
      </div>
    </section>
  </main>

  <footer class="footer-meta">
    <div class="footer-meta-inner">
      <span>MXD • Bongstudio – store.html v1.1 (cat param + origin encode).</span>
      <span>Gợi ý: từ trang chủ link tới <code>/store.html?cat=thoi-trang</code>, <code>?cat=gia-dung</code>…</span>
    </div>
  </footer>
</div>

<script>
(function(){
  const DATA_URL = "/assets/data/affiliates.json";

  const CATEGORY_LABELS = {
    all: "Tất cả danh mục",
    "thoi-trang": "Thời trang",
    "gia-dung": "Gia dụng",
    "me-va-be": "Mẹ & Bé",
    "suc-khoe": "Sức khỏe",
    "sach": "Sách",
    "do-an": "Đồ ăn"
  };

  const state = {
    all: [],
    cat: "all",
    sort: "default",
    devSku: "",
    devMode: false
  };

  const gridEl = document.getElementById("productGrid");
  const msgEl = document.getElementById("productMessage");
  const headingMetaEl = document.getElementById("headingMeta");
  const toolbarMetaEl = document.getElementById("toolbarMeta");
  const devHintEl = document.getElementById("devHint");
  const catSelect = document.getElementById("filterCategory");
  const sortSelect = document.getElementById("filterSort");

  /* ---------- helpers ---------- */
  function vnSlug(s){
    return (s||"").toString()
      .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
      .replace(/đ/g,"d").replace(/Đ/g,"D")
      .toLowerCase()
      .replace(/[^a-z0-9]+/g,"-")
      .replace(/^-+|-+$/g,"");
  }

  function normalizeCatParam(raw){
    if(!raw) return "all";
    const slug = vnSlug(raw);
    if(["thoi-trang","thoi-trang-nu","thoi-trang-nam","thoi-trang-nam-nu"].includes(slug)) return "thoi-trang";
    if(["gia-dung","do-gia-dung","nha-cua","nha-bep"].includes(slug)) return "gia-dung";
    if(["me-be","me-va-be","me-baby"].includes(slug)) return "me-va-be";
    if(["suc-khoe","suc-khoe-lam-dep","lam-dep"].includes(slug)) return "suc-khoe";
    if(["sach","sach-truyen","book"].includes(slug)) return "sach";
    if(["do-an","do-uong","banh-keo","thuc-pham"].includes(slug)) return "do-an";
    if(["featured","noi-bat","hot"].includes(slug)) return "featured";
    return slug;
  }

  function parseQuery(){
    const p = new URLSearchParams(window.location.search);
    const cat = normalizeCatParam(
      p.get("cat") || p.get("category") || p.get("dm")
    );
    const devSku = (p.get("sku") || "").trim().toLowerCase();
    const devMode = p.get("dev")==="1" || p.get("dev")==="true";
    return {cat, devSku, devMode};
  }

  function merchantLabel(m){
    const t = (m||"").toString().toLowerCase();
    if(t==="shopee") return "Shopee";
    if(t==="lazada") return "Lazada";
    if(t==="tiktok") return "TikTok";
    if(!t) return "Không rõ";
    return m;
  }

  function normalizeOrigin(u){
    if(!u) return "";
    let s = u.trim();
    // thêm https:// nếu chỉ có domain
    if(/^shopee\.vn\b/i.test(s) || /^lazada\.vn\b/i.test(s) || /^tiktok\.com\b/i.test(s)){
      s = "https://" + s;
    }
    if(!/^https?:\/\//i.test(s)){
      s = "https://" + s;
    }
    try{
      const hashIndex = s.indexOf("#");
      let hash = "";
      if(hashIndex>=0){
        hash = s.slice(hashIndex);
        s = s.slice(0,hashIndex);
      }
      const encoded = encodeURI(s);
      return hash ? encoded + hash : encoded;
    }catch(_){
      return s;
    }
  }

  function formatPrice(v){
    const n = Number(v||0);
    if(!n) return "Giá tham khảo";
    return n.toLocaleString("vi-VN") + "đ";
  }

  function escapeHtml(str){
    return String(str||"")
      .replace(/&/g,"&amp;")
      .replace(/</g,"&lt;")
      .replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;")
      .replace(/'/g,"&#39;");
  }

  function prettyDate(iso){
    if(!iso) return "";
    const d = new Date(iso);
    if(isNaN(d.getTime())) return "";
    return d.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"});
  }

  /* ---------- render ---------- */
  function applyFilters(){
    let list = state.all.filter(x => x && x.status !== false);

    const cat = state.cat;
    if(cat && cat!=="all"){
      if(cat==="featured"){
        list = list.filter(x => !!x.featured);
      }else{
        const cSlug = cat.toLowerCase();
        list = list.filter(x => (String(x.category||"").toLowerCase()) === cSlug);
      }
    }

    // sort
    if(state.sort==="price-asc"){
      list = list.slice().sort((a,b)=>(a.price_vnd||0)-(b.price_vnd||0));
    }else if(state.sort==="price-desc"){
      list = list.slice().sort((a,b)=>(b.price_vnd||0)-(a.price_vnd||0));
    }else if(state.sort==="updated-desc"){
      list = list.slice().sort((a,b)=>{
        const da = new Date(a.updated_at||0).getTime() || 0;
        const db = new Date(b.updated_at||0).getTime() || 0;
        return db - da;
      });
    }else{
      // default: giữ nguyên thứ tự JSON (coi như "thêm mới" ở cuối file)
      list = list.slice();
    }

    // dev: đẩy SKU đang test lên đầu
    if(state.devSku){
      const idx = list.findIndex(p => String(p.sku||"").toLowerCase() === state.devSku);
      if(idx>0){
        const [item] = list.splice(idx,1);
        list.unshift(item);
      }
    }

    return list;
  }

  function render(){
    const list = applyFilters();
    const total = state.all.length;
    const count = list.length;

    toolbarMetaEl.textContent =
      count && total
        ? `Hiển thị ${count} / ${total} sản phẩm`
        : total
          ? "Không có sản phẩm khớp bộ lọc."
          : "Chưa có sản phẩm trong kho JSON.";

    headingMetaEl.textContent =
      count
        ? `Đang hiển thị ${count} sản phẩm.`
        : "Không có sản phẩm phù hợp.";

    if(!count){
      gridEl.innerHTML = "";
      msgEl.innerHTML = '<div class="empty">Không tìm thấy sản phẩm cho bộ lọc hiện tại.</div>';
      return;
    }
    msgEl.innerHTML = "";

    const frag = document.createDocumentFragment();
    list.forEach(p=>{
      const card = renderCard(p);
      frag.appendChild(card);
    });

    gridEl.innerHTML = "";
    gridEl.appendChild(frag);

    if(state.devSku){
      const el = gridEl.querySelector('[data-sku="'+CSS.escape(state.devSku)+'"]');
      if(el){
        setTimeout(()=>{ el.scrollIntoView({behavior:"smooth",block:"center"}); }, 120);
      }
    }
  }

  function renderCard(p){
    const card = document.createElement("article");
    const sku = String(p.sku||"");
    const cat = String(p.category||"");
    const brand = String(p.brand||"");
    const merchant = merchantLabel(p.merchant);
    const origin = normalizeOrigin(p.origin_url || "");
    const deeplink = p.deeplink && String(p.deeplink).trim();
    const buyUrl = deeplink || origin || "#";
    const priceText = formatPrice(p.price_vnd);
    const updatedText = prettyDate(p.updated_at);

    card.className = "product-card";
    if(state.devSku && sku.toLowerCase()===state.devSku){
      card.classList.add("dev-highlight");
    }
    card.dataset.sku = sku;

    card.innerHTML = `
      ${p.featured ? '<div class="badge-featured">Nổi bật</div>' : ''}
      ${sku ? '<div class="badge-sku">'+escapeHtml(sku)+'</div>' : ''}
      <div class="product-media">
        <img src="${escapeHtml(p.image || "/assets/img/products/placeholder.webp")}"
             alt="${escapeHtml(p.name || "")}"
             loading="lazy">
      </div>
      <div class="product-body">
        <h3 class="product-title">${escapeHtml(p.name || "Sản phẩm")}</h3>
        <p class="product-merchant">Nguồn: ${escapeHtml(merchant)}</p>
        ${brand ? '<p class="product-brand">Thương hiệu: '+escapeHtml(brand)+'</p>' : ''}
        <p class="product-price">
          ${escapeHtml(priceText)}
        </p>
        <div class="product-footer">
          <a href="${escapeHtml(buyUrl || "#")}"
             class="btn-buy"
             target="_blank"
             rel="nofollow noopener">
             Mua ngay trên ${escapeHtml(merchant)}
          </a>
          <div class="meta-line">
            <span>${cat ? "Danh mục: "+escapeHtml(cat) : ""}</span>
            <span>${updatedText ? "Cập nhật: "+updatedText : ""}</span>
          </div>
        </div>
      </div>
    `;
    return card;
  }

  /* ---------- init ---------- */
  async function init(){
    const q = parseQuery();
    state.cat = q.cat || "all";
    state.devSku = q.devSku;
    state.devMode = q.devMode;

    // fill category select
    if(catSelect){
      catSelect.innerHTML = "";
      Object.entries(CATEGORY_LABELS).forEach(([value,label])=>{
        const opt = document.createElement("option");
        opt.value = value;
        opt.textContent = label;
        catSelect.appendChild(opt);
      });
      // thêm option "Nổi bật" riêng
      const optFeat = document.createElement("option");
      optFeat.value = "featured";
      optFeat.textContent = "Sản phẩm nổi bật";
      catSelect.appendChild(optFeat);

      // chọn theo query nếu có
      if(state.cat && state.cat!=="all"){
        const has = Array.from(catSelect.options).some(o=>o.value===state.cat);
        catSelect.value = has ? state.cat : "all";
      }else{
        catSelect.value = "all";
      }

      catSelect.addEventListener("change", ()=>{
        state.cat = catSelect.value || "all";
        render();
      });
    }

    if(sortSelect){
      sortSelect.addEventListener("change", ()=>{
        state.sort = sortSelect.value || "default";
        render();
      });
    }

    if(state.devMode && state.devSku){
      devHintEl.textContent = 'DEV: đang highlight SKU "'+state.devSku+'".';
    }

    try{
      toolbarMetaEl.textContent = "Đang tải dữ liệu…";
      const res = await fetch(DATA_URL+"?_="+Date.now(), {cache:"no-cache"});
      if(!res.ok) throw new Error("HTTP "+res.status);
      const json = await res.json();
      const list = Array.isArray(json) ? json : (json.items || []);
      state.all = list || [];
      toolbarMetaEl.textContent = "";
      render();
    }catch(e){
      console.error(e);
      gridEl.innerHTML = "";
      msgEl.innerHTML = '<div class="error">Không đọc được '+DATA_URL+' – kiểm tra lại đường dẫn hoặc quyền public JSON.</div>';
      toolbarMetaEl.textContent = "Lỗi tải JSON.";
    }
  }

  if(document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", init);
  }else{
    init();
  }
})();
</script>
</body>
</html>
