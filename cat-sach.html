<!-- REPLACE WHOLE FILE: /categories/sach.html -->
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Sách • Bongstudio</title>
  <meta name="description" content="Sách hay, dễ đọc, thực tế – từ phát triển bản thân, tài chính, tới nuôi dạy con và đời sống.">
  <link rel="canonical" href="https://bongstudio68.github.io/categories/sach.html"/>
  <meta property="og:title" content="Sách • Bongstudio"/>
  <meta property="og:description" content="Sách hay, dễ đọc, thực tế – từ phát triển bản thân, tài chính, tới nuôi dạy con và đời sống."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://bongstudio68.github.io/categories/sach.html"/>
  <meta property="og:image" content="https://bongstudio68.github.io/assets/img/categories/sach.webp"/>
  <meta name="robots" content="index,follow"/>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-550F47VKPR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-550F47VKPR');
  </script>

  <link rel="stylesheet" href="/assets/css/main.css"/>
</head>
<body class="page page-category">
  <header class="site-header">
    <div class="container">
      <a href="/" class="logo">
        <span class="logo-main">Bongstudio</span>
        <span class="logo-sub">Cửa hàng affiliate</span>
      </a>
      <nav class="main-nav">
        <ul>
          <li><a href="/">Trang chủ</a></li>
          <li><a href="/store.html">Cửa hàng</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <section class="page-hero">
      <div class="container">
        <p class="eyebrow">Danh mục</p>
        <h1>Sách</h1>
        <p class="lead">Những cuốn sách đáng đọc, dễ áp dụng, phù hợp cuộc sống hàng ngày.</p>
      </div>
    </section>

    <section class="page-section">
      <div class="container">
        <div class="product-grid" id="product-grid"></div>
        <p class="empty-state" id="empty-state" style="display:none">
          Danh mục này hiện chưa có sản phẩm. Bạn ghé lại sau hoặc xem thêm ở <a href="/store.html">Cửa hàng</a> nhé.
        </p>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>&copy; <span id="year"></span> Bongstudio • Chia sẻ sản phẩm chọn lọc.</p>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const CATEGORY_SLUG = 'sach';
      const grid = document.getElementById('product-grid');
      const emptyState = document.getElementById('empty-state');

      const AFF_BASE = {
        shopee: 'https://go.isclix.com/deep_link/6837508078414670452/4751584435713464237',
        lazada: 'https://go.isclix.com/deep_link/6837508078414670452/5127144557053758578',
        tiktok: 'https://go.isclix.com/deep_link/6837508078414670452/6648523843406889655'
      };
      const UTM_BASE = 'utm_source=' + encodeURIComponent(location.hostname) + '&utm_medium=affiliate';

      function makeIsclixUrl(base, originUrl, sku, merchant) {
        if (!originUrl) return '';
        if (!base) return originUrl;
        const sep = base.includes('?') ? '&' : '?';
        const head = base + sep + 'url=' + encodeURIComponent(originUrl);
        const params = [
          UTM_BASE,
          'utm_campaign=' + encodeURIComponent(merchant || ''),
          'sub1=' + encodeURIComponent(sku || ''),
          'sub2=' + encodeURIComponent(merchant || '')
        ];
        return head + '&' + params.join('&');
      }

      function formatPrice(value) {
        if (value === undefined || value === null || value === '') return '';
        try {
          return Number(value).toLocaleString('vi-VN') + '₫';
        } catch (e) {
          return value;
        }
      }

      function buildCard(item) {
        const article = document.createElement('article');
        article.className = 'product-card';

        const imgSrc = item.image || '/assets/img/placeholder.webp';
        const priceHtml = item.price ? '<span class="price">' + formatPrice(item.price) + '</span>' : '';
        const oldPriceHtml = item.old_price ? '<span class="price-old">' + formatPrice(item.old_price) + '</span>' : '';
        const merchant = (item.merchant || '').toLowerCase();
        const sku = item.sku || '';
        const origin = item.origin || '';

        article.innerHTML = `
          <div class="product-thumb">
            <img loading="lazy" src="${imgSrc}" alt="${item.name || ''}">
          </div>
          <div class="product-body">
            <h3 class="product-title">${item.name || ''}</h3>
            <div class="product-price-row">
              ${oldPriceHtml}
              ${priceHtml}
            </div>
            <button type="button"
              class="btn btn-buy"
              data-origin="${origin}"
              data-merchant="${merchant}"
              data-sku="${sku}">
              Mua ngay
            </button>
          </div>
        `;

        const btn = article.querySelector('.btn-buy');
        btn.addEventListener('click', function () {
          const base = AFF_BASE[merchant] || '';
          const url = makeIsclixUrl(base, origin, sku, merchant);
          if (url) {
            window.open(url, '_blank');
          } else {
            alert('Không tìm được link mua cho sản phẩm này.');
          }
        });

        return article;
      }

      fetch('/assets/data/affiliates.json')
        .then(function (res) {
          if (!res.ok) throw new Error('HTTP ' + res.status);
          return res.json();
        })
        .then(function (items) {
          const filtered = (items || []).filter(function (p) {
            return p.category === CATEGORY_SLUG;
          });

          if (!filtered.length) {
            emptyState.style.display = 'block';
            return;
          }

          const fragment = document.createDocumentFragment();
          filtered.forEach(function (item) {
            fragment.appendChild(buildCard(item));
          });
          grid.appendChild(fragment);
        })
        .catch(function (err) {
          console.error(err);
          emptyState.style.display = 'block';
        });
    });
  </script>
</body>
</html>
